version: 0.1
phases:
  install:
    commands:
      - curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
  pre_build:
    commands:
      - dep ensure
      - mkdir -p .aws/lambda
  build:
    commands:
      - go build -o .aws/lambda/commbot cli.go
      - zip $S3_KEY .aws/lambda/commbot
  post_build:
    commands:
      - aws s3 "$S3_KEY" "s3://$S3_BUCKET/$S3_KEY" 
      - aws lambda update-function-code --function-name "$TWITTER_POST_LAMBDA_ARN" --s3-bucket "$S3_BUCKET" --s3-key "$S3_KEY" 
      - aws lambda update-function-code --function-name "$POCKET_RSS_LAMBDA_ARN" --s3-bucket "$S3_BUCKET" --s3-key "$S3_KEY" 