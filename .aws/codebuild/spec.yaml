version: 0.2
phases:
  install:
    commands:
      - mkdir -p /go/src/${PACKAGE_NAME} && rm -rf /go/src/${PACKAGE_NAME}
      - ln -s ${CODEBUILD_SRC_DIR} /go/src/${PACKAGE_NAME}
      - cd /go/src/${PACKAGE_NAME}
  pre_build:
    commands:
      - GOPATH=/go dep ensure
  build:
    commands:
      - GOPATH=/go go build -o .aws/lambda/commbot cli.go
  post_build:
    commands:
      - zip ${S3_KEY} .aws/lambda/commbot
      - aws s3 cp "${S3_KEY}" "s3://${S3_BUCKET}/${S3_KEY}" 